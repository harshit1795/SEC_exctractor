<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FinQ Authentication</title>

  <!-- 1. Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  
  <!-- 2. Add the Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  
  <!-- 3. FirebaseUI -->
  <script src="https://www.gstatic.com/firebaseui/6.0.1/firebaseui.js"></script>
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebaseui/6.0.1/firebaseui.css" />

  <!-- 4. Streamlit Component Lib -->
  <script src="https://cdn.jsdelivr.net/gh/streamlit/streamlit/frontend/src/streamlit-component-lib.js"></script>
</head>
<body>
  <div id="firebaseui-auth-container"></div>
  <div id="loader">Loading...</div>

  <script type="text/javascript">
    // IMPORTANT: REPLACE WITH YOUR FIREBASE WEB APP CONFIG
    const firebaseConfig = {
      apiKey: "REPLACE_WITH_YOUR_API_KEY",
      authDomain: "REPLACE_WITH_YOUR_AUTH_DOMAIN",
      projectId: "REPLACE_WITH_YOUR_PROJECT_ID",
      storageBucket: "REPLACE_WITH_YOUR_STORAGE_BUCKET",
      messagingSenderId: "REPLACE_WITH_YOUR_MESSAGING_SENDER_ID",
      appId: "REPLACE_WITH_YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // FirebaseUI config.
    const uiConfig = {
      callbacks: {
        signInSuccessWithAuthResult: function(authResult, redirectUrl) {
          // User successfully signed in.
          // Get the ID token.
          authResult.user.getIdToken().then(function(idToken) {
            // Send the ID token to the Streamlit backend.
            Streamlit.setComponentValue({ "id_token": idToken });
          });
          // Return false to prevent redirect.
          return false;
        },
        uiShown: function() {
          // The widget is rendered.
          document.getElementById('loader').style.display = 'none';
        }
      },
      signInFlow: 'popup',
      signInSuccessUrl: '<YOUR_APP_URL>', // This is not used in popup flow
      signInOptions: [
        firebase.auth.GoogleAuthProvider.PROVIDER_ID,
        firebase.auth.FacebookAuthProvider.PROVIDER_ID,
        // Add other providers here
      ],
      // Other config options...
    };

    // The start method will wait until the DOM is loaded.
    const ui = new firebaseui.auth.AuthUI(auth);
    ui.start('#firebaseui-auth-container', uiConfig);

    // Set component height to be dynamic
    function onFrameHeightChanged(event) {
        Streamlit.setFrameHeight(event.detail.height);
    }
    window.addEventListener('frameheight-changed', onFrameHeightChanged);
    Streamlit.setFrameHeight(150); // Initial height
  </script>
</body>
</html>
